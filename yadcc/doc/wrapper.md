# 包装器

由于目前`yadcc`主要支持c/c++编译的分布式调度，对于java类项目的编译还是在本机进行。在使用`--cloud`参数进行java项目的编译时，脚本会根据机器情况加上`-j`参数，这会导致较高的并发数和较高的负载。出于控制并发数同时控制机器负载的目的，我们设计了包装器。

## 原理

- 将`java`、`javac`、`jar`三个编译可执行文件，软连接到包装器。通过配置编译环境，让这三个编译程序指向软连接包装器（目前blade编译工具是通过修改`BLADE_ROOT`的`java_home`来实现）。
- 包装器会首先向本地daemon请求一个quota，来执行这次的编译工作，在quota不足时，会等待。只有在获得quota，才能继续编译，这样我们在`-j`参数和daemon quota机制的配合下，控制并发数。
- 获得quota后会直接进行编译工作，真实的java环境从PATH环境变量中寻找。

## 用法

- 修改`BLADE_ROOT`的`java_home`配置，指向`~/.yadcc/symlinks`
- 将真实的java环境配置到`PATH`环境变量中，并且处于最高的优先级
- 启动`blade`命令行进行编译，加上`--cloud`参数

## 说明

本wrapper目前出于考虑功能完善的目的开发，功能比较简单，并且如果需要生产中使用需要配合blade工具的一些修改。如果需要更好的体验，需要后续支持更多的语言（go，scala），并且更好的与blade工具整合。
